<mui:ModernWindow x:Class="Quark.LoginWindow"
                  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
                  xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
                  xmlns:mui="http://firstfloorsoftware.com/ModernUI"
                  xmlns:ie="http://schemas.microsoft.com/xaml/behaviors" 
                  xmlns:local="clr-namespace:Quark.source.LoginWindow"
                  xmlns:converter="clr-namespace:Quark.source.Converters"
                  mc:Ignorable="d"
                  Title="Login | Quark"
                  Style="{StaticResource BlankWindow}" Height="400" Width="500" BorderBrush="Purple" ResizeMode="NoResize">
    <mui:ModernWindow.DataContext>
        <local:ViewModel/>
    </mui:ModernWindow.DataContext>

    <mui:ModernWindow.Resources>
        <converter:LoginWindowConverter x:Key="LoginWindowConverter" />
    </mui:ModernWindow.Resources>

    <mui:ModernWindow.InputBindings>
        <KeyBinding Command="{Binding LoginCommand}" Key="Enter">
            <KeyBinding.CommandParameter>
                <MultiBinding Converter="{StaticResource LoginWindowConverter}">
                    <Binding ElementName="GroupsCombo" Path="SelectedItem"/>
                    <Binding ElementName="StudentsCombo" Path="SelectedItem"/>
                    <Binding ElementName="PasswordField" />
                    <Binding ElementName="ThisWindow" />
                </MultiBinding>
            </KeyBinding.CommandParameter>
        </KeyBinding>
    </mui:ModernWindow.InputBindings>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="143*"/>
            <ColumnDefinition Width="207*"/>
            <ColumnDefinition Width="142*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="117*"/>
            <RowDefinition Height="32*"/>
            <RowDefinition Height="16*"/>
            <RowDefinition Height="33*"/>
            <RowDefinition Height="16*"/>
            <RowDefinition Height="30*"/>
            <RowDefinition Height="20*"/>
            <RowDefinition Height="20*"/>
            <RowDefinition Height="20*"/>
            <RowDefinition Height="36*"/>
            <RowDefinition Height="44*"/>
        </Grid.RowDefinitions>
        <ComboBox x:Name="GroupsCombo" Grid.Row="1" Grid.Column="1" ItemsSource="{Binding GroupItems}" TextBoxBase.TextChanged="OnGroupsComboTextChanged"
          IsTextSearchEnabled="False" IsEditable="True" HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
            <ie:Interaction.Triggers>
                <ie:EventTrigger EventName="SelectionChanged">
                    <ie:InvokeCommandAction Command="{Binding GroupsItemsSelectionChanged}"  CommandParameter="{Binding ElementName=GroupsCombo, Path=SelectedItem}"/>
                </ie:EventTrigger>
            </ie:Interaction.Triggers>
        </ComboBox>
        <ComboBox x:Name="StudentsCombo" Grid.Column="1" Grid.Row="3" ItemsSource="{Binding StudentItems}" TextBoxBase.TextChanged="OnStudentsComboTextChanged"
          IsTextSearchEnabled="False" IsEditable="True" HorizontalContentAlignment="Center" VerticalContentAlignment="Center"/>
        <PasswordBox x:Name="PasswordField" Grid.Column="1" Grid.Row="5" Password="Password" HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
            <ie:Interaction.Triggers>
                <ie:EventTrigger EventName="GotFocus">
                    <ie:InvokeCommandAction Command="{Binding PasswordField_GotFocus}"  CommandParameter="{Binding ElementName=PasswordField}"/>
                </ie:EventTrigger>
                <ie:EventTrigger EventName="LostFocus">
                    <ie:InvokeCommandAction Command="{Binding PasswordField_LostFocus}"  CommandParameter="{Binding ElementName=PasswordField}"/>
                </ie:EventTrigger>
            </ie:Interaction.Triggers>
        </PasswordBox>

        <Button Content="Войти" Grid.Column="1" Grid.Row="9" Command="{Binding LoginCommand}">
            <Button.CommandParameter>
                <MultiBinding Converter="{StaticResource LoginWindowConverter}">
                    <Binding ElementName="GroupsCombo" Path="SelectedItem"/>
                    <Binding ElementName="StudentsCombo" Path="SelectedItem"/>
                    <Binding ElementName="PasswordField" />
                    <Binding ElementName="RememberBox" Path="IsChecked"/>
                    <Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type mui:ModernWindow}}" />
                </MultiBinding>
            </Button.CommandParameter>
        </Button>
        <CheckBox x:Name="RememberBox" Content="Remember?" Grid.Column="1" Grid.Row="7"/>

    </Grid>
</mui:ModernWindow>
